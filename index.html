<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœŸæœ«æˆ°æƒ…å®¤ // Final Quest V4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; padding: 50px 0; }
        .main-card { border-radius: 20px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .emoji-box { font-size: 5rem; cursor: pointer; transition: transform 0.3s; }
        .completed-text { text-decoration: line-through; color: #adb5bd; }
        .all-pass-glow { box-shadow: 0 0 30px rgba(40, 167, 69, 0.5); border: 2px solid #28a745; }
        #myChart { max-height: 220px; margin: 0 auto; }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <h1 class="fw-bold mb-5 animate__animated animate__fadeIn">ğŸ æœŸæœ«å…¨æ”»ç•¥æˆ°æƒ…å®¤</h1>
                <div :class="['card', 'main-card', 'p-4', 'mb-4', { 'all-pass-glow': progress === 100 }]">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="emoji-box animate__animated animate__pulse animate__infinite">{{ statusEmoji }}</div>
                            <h3 class="mt-2 fw-bold">{{ statusText }}</h3>
                        </div>
                        <div class="col-md-6">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>
                    <div class="progress mt-4" style="height: 20px; border-radius: 50px;">
                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" :style="{ width: progress + '%' }"></div>
                    </div>
                </div>
                <div class="input-group mb-4 shadow-sm">
                    <input type="text" v-model="newTask" @keyup.enter="addTask" class="form-control form-control-lg border-0" placeholder="æ–°å¢æœ€å¾Œçš„ä»»å‹™...">
                    <button class="btn btn-primary px-4 fw-bold" @click="addTask">æ–°å¢ä»»å‹™</button>
                </div>
                <div class="list-group shadow-sm text-start">
                    <div v-for="(task, index) in tasks" :key="task.id" class="list-group-item d-flex justify-content-between align-items-center py-3">
                        <div @click="toggleTask(index)" style="cursor: pointer; flex-grow: 1;">
                            <span :class="{ 'completed-text': task.done }" class="fs-5">{{ task.done ? 'âœ…' : 'âš”ï¸' }} {{ task.content }}</span>
                        </div>
                        <button class="btn btn-sm btn-outline-danger border-0" @click="removeTask(index)">ğŸ—‘ï¸</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;
        createApp({
            setup() {
                const newTask = ref('');
                const tasks = ref(JSON.parse(localStorage.getItem('final-v4') || '[]'));
                let chart = null;

                const addTask = () => { if (newTask.value.trim()) { tasks.value.push({ id: Date.now(), content: newTask.value, done: false }); newTask.value = ''; } };
                const toggleTask = (index) => { tasks.value[index].done = !tasks.value[index].done; };
                const removeTask = (index) => { tasks.value.splice(index, 1); };

                const progress = computed(() => {
                    if (tasks.value.length === 0) return 0;
                    return Math.round((tasks.value.filter(t => t.done).length / tasks.value.length) * 100);
                });

                const statusEmoji = computed(() => {
                    if (tasks.value.length === 0) return 'ğŸ˜´';
                    return progress.value === 100 ? 'ğŸ¥³' : (progress.value >= 50 ? 'ğŸ˜' : 'ğŸ˜°');
                });

                const statusText = computed(() => {
                    if (tasks.value.length === 0) return 'å°šæœªé–‹æˆ°';
                    return progress.value === 100 ? 'å…¨æ•¸é€šéï¼' : (progress.value >= 50 ? 'ç©©äº†ï¼' : 'è¶•å·¥ä¸­...');
                });

                const initChart = () => {
                    chart = new Chart(document.getElementById('myChart'), {
                        type: 'doughnut',
                        data: { labels: ['å®Œæˆ', 'å¾…è¾¦'], datasets: [{ data: [0, 1], backgroundColor: ['#28a745', '#e9ecef'], borderWidth: 0 }] },
                        options: { cutout: '70%', plugins: { legend: { display: false } } }
                    });
                };

                const updateChart = () => {
                    if (!chart) return;
                    const done = tasks.value.filter(t => t.done).length;
                    const undone = tasks.value.length - done;
                    chart.data.datasets[0].data = tasks.value.length === 0 ? [0, 1] : [done, undone];
                    chart.update();
                };

                watch(tasks, () => { localStorage.setItem('final-v4', JSON.stringify(tasks.value)); updateChart(); }, { deep: true });
                onMounted(() => { initChart(); updateChart(); });
                return { newTask, tasks, addTask, removeTask, toggleTask, progress, statusEmoji, statusText };
            }
        }).mount('#app');
    </script>
</body>
</html>